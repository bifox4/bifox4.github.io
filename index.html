<!DOCTYPE html>

<html lang="fr">

    <head>

        <meta charset="UTF-8">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Jardin ConnectÃ©</title>

        <link rel="stylesheet" href="styles.css">

        <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

        <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>

        <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    </head>

<body class="background-image">



  <!-- Section principale -->

<section id="home-section" class="section active">

    <div class="content-container">



        <!-- Rectangle Calendrier -->

        <div class="box calendrier">

            <h2>ğŸŒ± Calendrier des 5 prochains jours ğŸŒ±</h2>

        </div>



        <h2>ğŸ“… Planning global dâ€™arrosage</h2>

  <div id="calendar">Clique sur "Analyser" pour gÃ©nÃ©rer le planning.</div>



        <!-- Rectangle Conseils -->

        <div class="box conseil">

            <h3>ğŸŒ¿ Conseil du jour :</h3>

            <p id="conseil-texte">Cliquez sur un jour pour obtenir un conseil !</p>

        </div>

 

    </div>

</section>

  

	
	
<section id="plants-section" class="section">
<h2>ğŸš€ ğŸš€</h2>
  <div id="donnee">
    
  </div>
</section>

  <head>
  <meta charset="UTF-8" />
  <title>Jardin ConnectÃ© DS18B20</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body { background: #f5f5f5; padding: 20px; }
    .donnee { font-weight: bold; margin: 10px 0; }
    #response { margin-top: 30px; padding: 15px; background: #fff; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-success">ğŸŒ¿ Jardin ConnectÃ© </h1>

    <button class="btn btn-primary" onclick="connectSerial()">ğŸ”Œ Se connecter Ã  l'Arduino</button>
    <button class="btn btn-info" onclick="readOnce()">ğŸ”„ Lire les donnÃ©es</button>
    <button class="btn btn-success" onclick="envoyerCommande('1')">Allumer la pompe</button>
    <button class="btn btn-danger" onclick="envoyerCommande('0')">Ã‰teindre la pompe</button>

    <div class="mt-3">
      <label>Nom de la plante :</label>
      <input type="text" id="plante" class="form-control" placeholder="ex: fraise, menthe, tomate...">
    </div>

    <div id="donnees" class="mt-3">
      <div class="donnee">ğŸŒ¡ TempÃ©rature : <span id="temp">--</span> Â°C</div>
      <div class="donnee">ğŸ’§ HumiditÃ© sol : <span id="humidite">--</span> %</div>
      <div class="donnee">â˜€ï¸ LuminositÃ© : <span id="lumiere">--</span></div>
      <div class="donnee">ğŸš° Pompe : <span id="pompe">--</span></div>
    </div>

    <button class="btn btn-warning mt-3" onclick="analyserDonnees()">ğŸ§  Analyser les donnÃ©es</button>
    <div id="response"></div>
  </div>

  <script>
    let port, reader, writer;
    let donnees = {};

    async function connectSerial() {
      try {
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 9600 });

        const decoder = new TextDecoderStream();
        const encoder = new TextEncoderStream();

        port.readable.pipeTo(decoder.writable);
        reader = decoder.readable.getReader();

        encoder.readable.pipeTo(port.writable);
        writer = encoder.writable.getWriter();

        alert("âœ… ConnectÃ© Ã  l'Arduino !");
      } catch (e) {
        alert("Erreur de connexion : " + e);
      }
    }

    async function readOnce() {
      if (!reader) return alert("Connecte-toi d'abord !");
      const { value } = await reader.read();
      if (!value) return;

      const data = value.trim();
      console.log(">>", data);

      const erreurTemp = data.includes("Erreur capteur");
      const regex = /TempÃ©rature: ([\d.]+|Erreur capteur).*?HumiditÃ© sol: (\d+).*?LuminositÃ©: (\d+).*?Pompe: (ON|OFF)/i;
      const match = data.match(regex);

      if (match) {
        document.getElementById("temp").textContent = erreurTemp ? "Erreur" : match[1];
        document.getElementById("humidite").textContent = match[2];
        document.getElementById("lumiere").textContent = match[3];
        document.getElementById("pompe").textContent = match[4];

        if (!erreurTemp) {
          donnees = {
            temperature: match[1],
            humidite: match[2],
            lumiere: match[3],
            pompe: match[4]
          };
        }
      }
    }

    async function envoyerCommande(cmd) {
      if (!writer) return alert("Connecte-toi d'abord !");
      try {
        await writer.write(cmd);
        console.log("Commande envoyÃ©e :", cmd);
      } catch (err) {
        console.error("Erreur envoi :", err);
      }
    }

    async function analyserDonnees() {
      const plante = document.getElementById("plante").value.trim();
      if (!plante || !donnees.temperature) {
        return alert("Remplis le nom de la plante et lis les donnÃ©es d'abord.");
      }

      const prompt = `J entretien un(e) ${plante}. Voici les donnÃ©es actuelles du jardin :
TempÃ©rature: ${donnees.temperature}Â°C
HumiditÃ© du sol: ${donnees.humidite}%
LuminositÃ©: ${donnees.lumiere}

En te basant sur ces donnÃ©es et les besoins typiques de cette plante, crÃ©e un calendrier intelligent d'arrosage pour dire quand activer l'arosage automatique et sous forme de tableau et donne moi des conseils d'entretient.`;

      const responseDiv = document.getElementById("response");
      responseDiv.innerHTML = "â³ Analyse en cours...";

      try {
        const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: {
            Authorization: 'Bearer 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',
            'Content-Type': 'application/json',
            'HTTP-Referer': 'https://www.e-jardin.com',
            'X-Title': 'e-jardin'
          },
          body: JSON.stringify({
            model: 'deepseek/deepseek-r1:free',
            messages: [{ role: 'user', content: prompt }]
          })
        });

        const data = await res.json();
        const markdownText = data.choices?.[0]?.message?.content || 'Pas de rÃ©ponse.';
        responseDiv.innerHTML = marked.parse(markdownText);
      } catch (err) {
        responseDiv.innerHTML = 'Erreur : ' + err.message;
      }
    }
  </script>
</body>
</div>
</section>






    <!-- Section Ã€ Propos -->

    <section id="about-section" class="section">

        <h2>â„¹ï¸ Ã€ Propos â„¹ï¸</h2>

        <h3>EQUIPE DE DEVELOPPMENT </h3>

        <h4> 

            <br>

            Ianis   > Financeur et Developpeur systÃ¨me embarquÃ© <br>

            LÃ©ane   > ingÃ©nieur en systÃ¨mes embarquÃ©s<br>

            Tiradol > DÃ©vellopeur web <br>

            Blanche > business analyst <br>

            Tedja   > Designeuse 3D <br>

            Lina    > Designeuse 3D <br>

            Hugo    > Consultant en innovation</h4>

      </section>

    </section>



    <!-- section analyse des plantes  -->

    <section id="ar-section" class="section">

        <h2>ğŸ•¶ï¸ Mes Plantes ğŸ•¶ï¸</h2>

        <div id="camera-container">

            <video id="video" autoplay muted playsinline></video>

            <canvas id="ar-overlay"></canvas>

        </div>



        <div id="info-box">

            <h3 id="plant-name">Nom scientifique & commun</h3>

        </div>



        <div class="btn-container">

            <button id="start-button" class="btn-start">DÃ©marrer la camÃ©ra</button>

            <button id="analyze-button" class="btn-analyze">Analyser</button>

        </div>



        <div class="btn-container">

            <button class="btn-camera" onclick="switchCamera('environment')">CamÃ©ra arriÃ¨re</button>

            <button class="btn-camera" onclick="switchCamera('user')">CamÃ©ra avant</button>

        </div>

        <div class="btn-container">

        <button id="add-plant-from-ar" class="btn-add-plant" style="display: none;">â• Ajouter Ã  Mon Jardin</button>

    </div>



    </section>


   <!-- section analyse des plantes  -->
    <section id="RA-section" class="section">
  <h2>ğŸš€ RÃ©alitÃ© AugmentÃ©e ğŸš€</h2>
  <div id="ar-container">
    
  </div>
</section>

        
	<script type="module">
      import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js';
      import { ARButton } from 'https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/webxr/ARButton.js';

      let camera, scene, renderer;
      let controller, reticle;
      let hitTestSource = null;
      let hitTestSourceRequested = false;
      let imagePlaced = false;

      init();

      function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera();

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);

        // WebXR ARButton
        const arContainer = document.getElementById('ar-container');
        arContainer.appendChild(ARButton.createButton(renderer, {
        requiredFeatures: ['hit-test']
        }));


        // RÃ©ticule vert
        const ringGeo = new THREE.RingGeometry(0.05, 0.06, 32).rotateX(-Math.PI / 2);
        const ringMat = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        reticle = new THREE.Mesh(ringGeo, ringMat);
        reticle.matrixAutoUpdate = false;
        reticle.visible = false;
        scene.add(reticle);

        // ContrÃ´leur XR
        controller = renderer.xr.getController(0);
        controller.addEventListener('select', () => {
          if (reticle.visible && !imagePlaced) {
            placeImageAtReticle();
          }
        });
        scene.add(controller);

        renderer.setAnimationLoop(render);
      }

      function placeImageAtReticle() {
  const textureLoader = new THREE.TextureLoader();
  textureLoader.load(
    'https://i.postimg.cc/ht3xvhJ6/a0893b32-98cd-4243-898e-97450f7ffdea.png',
    (texture) => {
      const width = 0.35;  // 30 cm
      const height = 0.25; // 20 cm

      const geometry = new THREE.PlaneGeometry(width, height);
      const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
      const imagePlane = new THREE.Mesh(geometry, material);

      imagePlane.matrixAutoUpdate = false;
      imagePlane.matrix.copy(reticle.matrix);

      // DÃ©calage vertical de 0.5 m
      const position = new THREE.Vector3();
      const quaternion = new THREE.Quaternion();
      const scale = new THREE.Vector3();
      reticle.matrix.decompose(position, quaternion, scale);
      position.y += 0.5;
      imagePlane.matrix.compose(position, quaternion, scale);

      scene.add(imagePlane);
      imagePlaced = true;
    },
    undefined,
    (err) => {
      console.error("Erreur chargement image :", err);
    }
  );
}

      function render(_, frame) {
        if (frame) {
          const referenceSpace = renderer.xr.getReferenceSpace();
          const session = renderer.xr.getSession();

          if (!hitTestSourceRequested) {
            session.requestReferenceSpace('viewer').then((viewerSpace) => {
              session.requestHitTestSource({ space: viewerSpace }).then((source) => {
                hitTestSource = source;
              });
            });

            session.addEventListener('end', () => {
              hitTestSourceRequested = false;
              hitTestSource = null;
            });

            hitTestSourceRequested = true;
          }

          if (hitTestSource) {
            const hitTestResults = frame.getHitTestResults(hitTestSource);
            if (hitTestResults.length > 0) {
              const hit = hitTestResults[0];
              const pose = hit.getPose(referenceSpace);
              reticle.visible = true;
              reticle.matrix.fromArray(pose.transform.matrix);
            } else {
              reticle.visible = false;
            }
          }
        }

        renderer.render(scene, camera);
      }
       </script>
  </body>



  <nav class="navbar">

    <button class="nav-btn" data-target="home-section" onclick="affpas()"><span class="emoji">ğŸ¡</span></button>

    <button class="nav-btn" data-target="ar-section" onclick="affpas()"><span class="emoji">ğŸ•¶ï¸</span></button>

    <button class="nav-btn" data-target="plants-section" onclick="affpas()"><span class="emoji">ğŸŒ¿</span></button>

    <button class="nav-btn" data-target="RA-section" onclick="affok()"><span class="emoji">ğŸš€</span></button>

    <button class="nav-btn" data-target="about-section" onclick="affpas()"><span class="emoji">â”</span></button>

</nav>

    

<script src="script.js" defer></script>

</body>

</html>

 
