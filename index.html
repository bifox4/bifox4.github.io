<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Plante - Zoom Caméra</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 4px;
            z-index: 100;
            max-width: 80%;
        }
        
        .control-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        #ar-button {
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        #zoom-in, #zoom-out {
            padding: 12px 20px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        #permission-request {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            text-align: center;
            padding: 20px;
        }
        
        #permission-button {
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }
        
        #zoom-level {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="permission-request">
        <h2>Application AR Plante</h2>
        <p>Cette application utilise la réalité augmentée avec zoom de caméra.</p>
        <p>Elle nécessite l'accès à votre caméra.</p>
        <button id="permission-button">Autoriser la caméra et démarrer</button>
    </div>

    <div id="info">
        Déplacez votre appareil. Appuyez sur "Placer le marqueur" pour afficher les instructions.
    </div>

    <div id="zoom-level">Zoom: 1x</div>
    
    <div class="control-panel">
        <button id="zoom-out">-</button>
        <button id="ar-button" disabled>Placer le marqueur</button>
        <button id="zoom-in">+</button>
    </div>

    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="logarithmicDepthBuffer: true; precision: medium;"
        embedded>

        <!-- Marqueur virtuel -->
        <a-entity id="virtual-marker" visible="false">
            <a-entity id="ar-content">
                <a-text value="Arroser cette plante" 
                        color="white" 
                        align="center" 
                        width="2"
                        position="0 0.5 0"
                        background="color: #4CAF50; opacity: 0.7; padding: 0.2">
                </a-text>
            </a-entity>
        </a-entity>

        <!-- Caméra AR avec contrôle de zoom -->
        <a-entity id="ar-camera" camera="zoom: 1" position="0 0 0"></a-entity>
    </a-scene>

    <script>
        // Éléments DOM
        const permissionRequest = document.getElementById('permission-request');
        const permissionButton = document.getElementById('permission-button');
        const arButton = document.getElementById('ar-button');
        const zoomInButton = document.getElementById('zoom-in');
        const zoomOutButton = document.getElementById('zoom-out');
        const zoomLevelDisplay = document.getElementById('zoom-level');
        const info = document.getElementById('info');
        const virtualMarker = document.getElementById('virtual-marker');
        const arCamera = document.getElementById('ar-camera');
        const scene = document.querySelector('a-scene');

        // Variables d'état
        let markerPlaced = false;
        let currentZoom = 1;

        // Démarrer l'expérience AR
        permissionButton.addEventListener('click', async () => {
            try {
                permissionRequest.style.display = 'none';
                arButton.disabled = false;
                zoomInButton.disabled = false;
                zoomOutButton.disabled = false;
                
                // Attendre que la scène soit prête
                await new Promise(resolve => scene.addEventListener('loaded', resolve));
                
                info.textContent = "Déplacez votre appareil. Appuyez sur 'Placer le marqueur'";
                
            } catch (error) {
                info.textContent = "Erreur: " + error.message;
                console.error(error);
            }
        });

        // Placer le marqueur
        arButton.addEventListener('click', () => {
            if (!markerPlaced) {
                virtualMarker.setAttribute('visible', 'true');
                
                // Positionner le marqueur 1.5m devant la caméra
                virtualMarker.setAttribute('position', {x: 0, y: 0, z: -1.5});
                
                markerPlaced = true;
                arButton.textContent = "Retirer le marqueur";
                info.textContent = "Marqueur placé: Arroser cette plante";
            } else {
                virtualMarker.setAttribute('visible', 'false');
                markerPlaced = false;
                arButton.textContent = "Placer le marqueur";
                info.textContent = "Déplacez votre appareil. Appuyez sur 'Placer le marqueur'";
            }
        });

        // Contrôle du zoom
        zoomInButton.addEventListener('click', () => {
            currentZoom = Math.min(3, currentZoom + 0.2);
            updateCameraZoom();
        });

        zoomOutButton.addEventListener('click', () => {
            currentZoom = Math.max(0.5, currentZoom - 0.2);
            updateCameraZoom();
        });

        function updateCameraZoom() {
            arCamera.setAttribute('camera', 'zoom', currentZoom);
            zoomLevelDisplay.textContent = `Zoom: ${currentZoom.toFixed(1)}x`;
            
            // Ajuster la taille du texte en fonction du zoom
            const text = virtualMarker.querySelector('a-text');
            if (text) {
                text.setAttribute('width', 2 / currentZoom);
            }
        }
    </script>
</body>
</html>
